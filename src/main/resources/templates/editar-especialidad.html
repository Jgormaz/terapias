<<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Editar Especialidad</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <h2>Editar Especialidad</h2>

    <form th:action="@{/especialidades/actualizar}" method="post" th:object="${especialidad}">
        <!-- Campo oculto con el ID de la especialidad -->
        <input type="hidden" th:field="*{idEspecialidad}"/>

        <label>Nombre:</label>
        <input type="text" th:field="*{nombre}" required />

        <label>Descripción:</label>
        <input type="text" th:field="*{descripcion}" required />

        <h3>Servicios:</h3>
        <div th:each="servicio, stat : *{servicios}" style="margin-bottom: 1em;" class="servicio-item">

            <input type="hidden" th:field="*{servicios[__${stat.index}__].idServicio}" />

            <label>Nombre del Servicio:</label>
            <input type="text" th:name="'servicios[' + ${stat.index} + '].nombre'"
                          th:value="${servicio.nombre}" required />

            <label>Descripción:</label>
            <input type="text" th:name="'servicios[' + ${stat.index} + '].descripcion'"
                          th:value="${servicio.descripcion}" />

            <!-- Botón para eliminar servicio por AJAX -->
            <button type="button"
                    th:attr="onclick=|eliminarServicio('${servicio.idServicio}', '${especialidad.idEspecialidad}', this)|">
                Eliminar
            </button>
        </div>

        <button type="submit">Actualizar</button>
    </form>

    <a href="/especialidades">Cancelar</a>

    <!-- Script para eliminar sin recargar la página -->
    <script>
        function eliminarServicio(idServicio, idEspecialidad, boton) {
            if (!confirm('¿Eliminar este servicio?')) return;

            fetch('/especialidades/eliminarServicio', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `idServicio=${idServicio}&idEspecialidad=${idEspecialidad}`
            })
            .then(response => {
                if (response.ok) {
                    // Eliminar visualmente el bloque de servicio
                    const contenedor = boton.closest('.servicio-item');
                    contenedor.remove();
                } else {
                    alert("Error al eliminar el servicio.");
                }
            });
        }
    </script>

</body>
</html>

