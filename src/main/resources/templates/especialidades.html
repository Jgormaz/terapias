<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Especialidades</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const botones = document.querySelectorAll('.btn-toggle-servicios');
            botones.forEach(boton => {
                boton.addEventListener('click', function () {
                    const id = this.getAttribute('data-id');
                    const divServicios = document.getElementById('servicios-' + id);
                    if (divServicios) {
                        divServicios.style.display = (divServicios.style.display === 'none') ? 'block' : 'none';
                    }
                });
            });
        });
    </script>
</head>
<body>

<h2>Lista de Especialidades</h2>

<table border="1">
    <thead>
    <tr>
        <th>Nombre</th>
        <th>Descripción</th>
        <th>Servicios</th>
        <th>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="esp : ${especialidades}">
        <td th:text="${esp.nombre}"></td>
        <td th:text="${esp.descripcion}"></td>
        <td>
            <button type="button" class="btn-toggle-servicios" th:attr="data-id=${esp.idEspecialidad}">
                Ver servicios
            </button>

            <!-- Div para servicios -->
            <div th:id="'servicios-' + ${esp.idEspecialidad}" style="display:none; margin-top:10px;">
                <table border="1" style="margin-top:10px;">
                    <thead>
                    <tr>
                        <th>Nombre del Servicio</th>
                        <th>Descripción</th>
                        <th>Acción</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="serv : ${esp.servicios}">
                        <td th:text="${serv.nombre}"></td>
                        <td th:text="${serv.descripcion}"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <form th:action="@{/especialidades/agregarServicio}" method="post">
                                <input type="hidden" name="idEspecialidad" th:value="${esp.idEspecialidad}" />
                                <input type="text" name="nombre" placeholder="Nombre del servicio" required />
                                <input type="text" name="descripcion" placeholder="Descripción" required />
                                <button type="submit">Agregar</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </td>
        <td>
            <a th:href="@{/especialidades/editar/{id}(id=${esp.idEspecialidad})}">Editar</a>
            <a th:href="@{/especialidades/eliminar/{id}(id=${esp.idEspecialidad})}">Eliminar</a>
        </td>
    </tr>
    </tbody>
</table>

<!-- Formulario para nueva especialidad -->
<h3>Agregar Nueva Especialidad</h3>
<form th:action="@{/especialidades/guardar}" th:object="${especialidad}" method="post">
    <label>Nombre:</label>
    <input type="text" th:field="*{nombre}" placeholder="Nombre de la especialidad" required />
    <br />
    <label>Descripción:</label>
    <input type="text" th:field="*{descripcion}" placeholder="Descripción" required />
    <br />
    <button type="submit">Guardar</button>
</form>

</body>
</html>
